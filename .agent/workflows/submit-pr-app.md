---
description: Bump app version, compile requirements, and submit a PR
---

# Submit PR for App (with Semver)

This workflow automates bumping the patch version in `app/pyproject.toml`, recompiling `app/requirements.txt` using `uv`, and submitting a pull request.

## Steps

1. **Get Current Version**
   Extract the version from `pyproject.toml` using the virtual environment's python (which supports `tomllib`).
   ```bash
   OLD_VERSION=$(./app/.venv/bin/python -c "import tomllib; print(tomllib.load(open('app/pyproject.toml', 'rb'))['project']['version'])")
   echo "Current version: $OLD_VERSION"
   ```

2. **Calculate New Version**
   ```bash
   NEW_VERSION=$(./app/.venv/bin/python -c "v = '$OLD_VERSION'.split('.'); v[-1] = str(int(v[-1]) + 1); print('.'.join(v))")
   echo "New version: $NEW_VERSION"
   ```

3. **Create and Switch to Branch**
   ```bash
   git checkout -b release/v$NEW_VERSION
   ```

4. **Update pyproject.toml**
   ```bash
   sed -i '' "s/version = \"$OLD_VERSION\"/version = \"$NEW_VERSION\"/" app/pyproject.toml
   ```

// turbo
5. **Sync Requirements**
   Update `app/requirements.txt` to match `app/pyproject.toml` using `uv`.
   ```bash
   uv pip compile app/pyproject.toml -o app/requirements.txt
   ```

6. **Stage and Commit Changes**
   ```bash
   git add app/pyproject.toml app/requirements.txt
   git commit -m "chore: bump version to v$NEW_VERSION"
   ```

// turbo
7. **Push to Origin**
   ```bash
   git push -u origin release/v$NEW_VERSION
   ```

// turbo
8. **Create Pull Request**
   ```bash
   gh pr create --title "chore: bump version to v$NEW_VERSION" --body "This PR bumps the application version to $NEW_VERSION and updates the autogenerated requirements file."
   ```
